<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payment Successful</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="message">
      <h1>✅ Payment Successful!</h1>
      <p>Thank you for your payment.</p>

      <p><strong>Name:</strong> <span id="customer-name">Loading...</span></p>
      <p>Your payment was completed on:</p>
      <p id="payment-date" class="date-box"></p>

      <a href="index.html">Return to Shop</a>
    </div>

    <script>
      async function showPaymentDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        const sessionId = urlParams.get("session_id");

        if (!sessionId) {
          document.getElementById("customer-name").textContent = "Unknown";
          document.getElementById("payment-date").textContent = "N/A";
          return;
        }

        try {
          const res = await fetch(
            `https://shop-backend-dom2.onrender.com/session/${sessionId}`
          );
          const data = await res.json();

          if (data.error) throw new Error(data.error);

          const date = new Date().toLocaleDateString("en-GB", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });

          document.getElementById("customer-name").textContent =
            data.customer_name || "Unknown";
          document.getElementById("payment-date").textContent = date;
        } catch (err) {
          console.error("❌ Error fetching payment details:", err);
          document.getElementById("customer-name").textContent = "Error";
          document.getElementById("payment-date").textContent =
            "Could not load details";
        }
      }

      showPaymentDetails();
    </script>
  </body>
</html>
