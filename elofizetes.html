<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Payee</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header>
      <h1><a href="./index.html" class="home-link">Sonda SHOP</a></h1>
      <div>Cart: <span id="cart-count">0</span></div>
      <div style="margin-top: 30px">
        <button class="button-check" id="cart-button">Fizet√©s!</button>
      </div>
    </header>

    <main>
      <div>
        <p>
          Ha els≈ë regisztr√°l√≥ vagy, vagy m√°s √∂sszeget szeretn√©l k√ºldeni
          <em><strong>(egyeztet√©s ut√°n)</strong></em>,
          haszn√°ld az ‚¨áÔ∏è (√ñsszeg) mez≈ët. ‚¨áÔ∏è
        </p>
      </div>

      <!-- ‚úÖ Name input -->
      <div class="checkout-box" style="margin-top: 20px">
        <label for="payer-name">Neved k√©rem:</label>
        <input
          type="text"
          id="payer-name"
          placeholder="√çrd be a neved"
          required
        />
      </div>

      <!-- ‚úÖ Custom amount input -->
      <div class="checkout-box" style="margin-top: 20px">
        <input
          type="number"
          id="custom-amount"
          placeholder="√ñsszeg (¬£)"
          min="0.01"
          step="0.01"
        />
        <button id="add-custom">√ñsszeg Hozz√°ad√°sa</button>
      </div>
    </main>

    <!-- ‚úÖ Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>

    <script>
      const stripe = Stripe("pk_live_51N67KeFYbT9vhXCbG4eD7Zru8jC4gE6TJCRblelKS4h6TwEC75dKDUhq7cy9o2xee0OVC2EG2OOi7S6MLuGLqM5Q00rtiPwVw5");
      let cart = [];

      document.getElementById("add-custom").addEventListener("click", () => {
        const amount = parseFloat(document.getElementById("custom-amount").value);
        const payerName = document.getElementById("payer-name").value.trim();

        if (isNaN(amount) || amount <= 0) {
          alert("K√©rlek, adj meg egy √©rv√©nyes √∂sszeget!");
          return;
        }

        if (!payerName) {
          alert("K√©rlek, add meg a neved!");
          return;
        }

        // Add item to cart
        cart = [
          {
            name: payerName, // ‚úÖ this is the payer's name
            price: amount,
            quantity: 1,
          },
        ];

        alert(`¬£${amount.toFixed(2)} hozz√°adva ${payerName} n√©vvel!`);
      });

      document.getElementById("cart-button").addEventListener("click", () => {
        if (cart.length === 0) {
          alert("A kos√°r √ºres!");
          return;
        }

        console.log("üõí Sending cart:", cart);

        fetch("https://shop-backend-dom2.onrender.com/create-checkout-session", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            cart,
            customerName: cart[0].name, // ‚úÖ send name to backend
          }),
        })
          .then((res) => res.json())
          .then((data) => {
            console.log("üí¨ Server returned:", data);
            if (!data.id) throw new Error("Missing session ID from server!");
            return stripe.redirectToCheckout({ sessionId: data.id });
          })
          .catch((err) => alert("Error: " + err.message));
      });
    </script>
  </body>
</html>
